<project name="jumpy" default="dist" basedir=".">

	<property name="jumpy" value="jumpy-0.1.5" />
	<property name="src" location="src"/>
	<property name="build" location="build"/>
	<property name="dist" location="dist"/>
	<property name="xbmc" value="xbmc-0.2.7"/>

	<path id="lib.path.ref">
		<fileset id="libs.ref" dir="lib" includes="*.jar"/>
	</path>

	<target name="init" >
		<tstamp/>
		<mkdir dir="${build}"/>
	</target>

	<target name="compile" depends="init" >
		<javac srcdir="${src}" destdir="${build}" classpathref="lib.path.ref">
		</javac>
	</target>

	<target name="jar" depends="clean, compile" >
		<copy file="${src}/plugin" todir="${build}"/>
		<jar jarfile="${jumpy}.jar" basedir="${build}">
			<manifest>
				<attribute name="Class-Path" value="jumpy/lib/py4j0.7.jar"/>
			</manifest>
		</jar>
	</target>

	<target name="util">
		<ant dir="util" useNativeBasedir="true" inheritAll="false"/>
	</target>

	<target name="dist" depends="jar, util" >
		<mkdir dir="${dist}/jumpy/lib"/>
		<copy file="${jumpy}.jar" todir="${dist}"/>
		<copy file="readme.html" todir="${dist}/jumpy"/>
		<copy todir="${dist}/jumpy">
			<fileset dir="script" excludes="**/*.pyc **/*log* **/*test* **/*.0 **/ignore/**"/>
		</copy>
		<copy file="${src}/lib/jumpy.py" todir="${dist}/jumpy/lib"/>
		<copy file="lib/py4j0.7.jar" todir="${dist}/jumpy/lib"/>
		<zip destfile="pms-${jumpy}.zip" basedir="${dist}"/>
	</target>

	<target name="src" >
		<delete file="pms-${jumpy}-src.zip" />
		<delete dir="tmp"/>
		<exec executable = "git">
			<arg value = "clone" />
			<arg value = "file://${basedir}" />
			<arg value = "tmp/${jumpy}" />
			<arg value = "-b" />
			<arg value = "master" />
			<arg value = "--no-hardlinks" />
			<arg value = "--depth" />
			<arg value = "1" />
		</exec>
		<copy file="readme-compile.txt" todir="tmp/${jumpy}"/>
		<!-- using system zip because ant zip task omits git files -->
		<exec executable = "zip" dir="tmp">
			<arg value = "-r" />
			<arg value = "../pms-${jumpy}-src.zip" />
			<arg value = "${jumpy}" />
		</exec>
		<delete dir="tmp"/>
	</target>

	<target name="xbmc" >
		<delete file="${xbmc}.zip" />
		<mkdir dir="tmp"/>
		<copy todir="tmp">
			<fileset dir="script" includes="**/*xbmc* xbmc/*.py" excludes="**/*.pyc **/*test* **/*.0 **/ignore/**"/>
		</copy>
		<zip destfile="${xbmc}.zip" basedir="tmp"/>
		<delete dir="tmp"/>
	</target>

	<target name="clean" >
		<delete dir="${build}"/>
		<delete file="${jumpy}.jar" />
		<delete file="pms-${jumpy}.zip" />
		<delete dir="${dist}"/>
	</target>

</project>


